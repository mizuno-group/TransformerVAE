# TransformerVAE
This document describes the codes used in the paper and how to replicate the result.

## Environment
The following packages are required. Note that the latest versions have now possibly become incompatible with our codes, and older versions in these ranges may work.
- python>=3.7
- numpy>=1.21
- pandas>=1.2
- tqdm>=4.63
- addict>=2.4
- rdkit==2023.03
- PyTorch==1.12

You can build a conda environment using [requirements.txt](requirements.txt) except PyTorch like the following commands. For PyTorch package, please install the proper version according to your GPU environment.
```sh
conda create -n transformervae python==3.7
conda activate transformervae
conda install pip
pip install -r requirements.txt
```

## Data preprocessing for training
To train the model with SMILES dataset, you first need to canonicalize and randomize SMILES and then tokenize them.   
```
python preprocess/preprocess.py --processname train_example --data path_to_train_smiles_data.txt
python preprocess/preprocess.py --processname val_example --data path_to_val_smiles_data.txt
```
Input SMILES file ("*path_to_train/val_smiles_data.txt*") must contain one SMILES string in each row without header.

## Training
Transformer VAE model can be trained by the processed random/canonical SMILES
```
python train.py --name example --train_data train_example --val_data val_example
```

## Trained model weights
Trained model weight can be downloaded from [Google Drive](https://drive.google.com/open?id=1nAWJpFPSsnd_y3nE7xHWcdSgA64WX5Je&usp=drive_fs).  
Currently, the following models are available:
- moses/: Fully trained model trained by [MOSES](https://github.com/molecularsets/moses) dataset.
- zinc/: Fully trained model trained by [ZINC-15](https://zinc15.docking.org/) dataset.  

Weights of each module in the model is stored separetely in the above directories.

## Molecule generation
Molecules can be generated by your trained or downloaded model.
```
python generation/generate.py --weight path_to_model_weight_dir --n 30000 --name example
```
Generated molecules will be stored in generation/results/example/smiles.txt



